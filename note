# ->Predict Phase
# たくさん画像いれてgui.pyで良くないやつをピックアップしてneedFixへ
# convertToTiff.pyでneedFixからTiff画像にしてTiffsに保存。
# Tiffにしたらノートパソコンから取り出してCVATにあげる ->Annotation Phase。
# CVATでアノテーションしまくる
# 出力形式は「LabelMe JSON 1.1」
# Annotation Phase -> Training Phase

```bash(setup_nnunet.sh)
# nnU-Netのインストール（まだの場合）
pip install nnunetv2
# 環境変数の設定
export nnUNet_raw="パス/to/nnUNet_raw"
export nnUNet_preprocessed="パス/to/nnUNet_preprocessed"
export nnUNet_results="パス/to/nnUNet_results"
```

`cvat_to_nnunet.py` を編集して、以下の設定を変更します:
```python
# タスクID（001-999の範囲で他のタスクと重複しないように）
TASK_ID = 102
TASK_NAME = "EyeMuscleSegmentation"

# 入力データのパス
CVAT_JSON_DIR = "datasets/cvat_output"  # CVATからエクスポートしたJSONがある場所
TIFF_IMAGE_DIR = "DATA/Tiffs"           # 元のTIFF画像がある場所

# ラベルマッピング
LABEL_MAP = {
    "ir": 1,
    "mr": 2,
    "sr": 3,
    "so": 4,
    "lr": 5,
    "io": 6,
}
```

```bash
python cvat_to_nnunet.py
```
でデータ準備(json->nifti)

# プランニングと前処理
```bash
# データセットの検証と前処理計画
nnUNetv2_plan_and_preprocess -d 102 --verify_dataset_integrity
# 2D学習の場合
nnUNetv2_train 102 2d 0
# 3D学習の場合（スライス数が十分にある場合）
nnUNetv2_train 102 3d_fullres 0
```

# 学習開始（100エポック）
python train_nnunet.py --mode train #--task_id 501 --epochs 100

python codes/train_nnunet.py --mode predict --task_id 501 \
  --input_folder C:/Users/mitae/workspace/imageProcessing/nnUnet/raw_data/Dataset501_EyeMuscleSegmentation/imagesTs

;   C:/Users/mitae/workspace/Tom500/TOM500/train/image
  

# -> Predict Phase
# predict.py で試してみて良さげだったらbestを取り出してノートパソコンへ入れる。
